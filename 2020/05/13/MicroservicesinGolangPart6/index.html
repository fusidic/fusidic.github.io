<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Microservices in Golang - Part6 - Fusidic&#039;s blog</title><meta description="内容提要：API GATEWAY &amp;amp; UI 原作者：Ewan Valentine 原文链接：https:&amp;#x2F;&amp;#x2F;ewanvalentine.io&amp;#x2F;microservices-in-golang-part-6&amp;#x2F; 引言前文中我们从事件驱动架构出发，关注了 go-micro 和原生 go 中事件驱动的一般实现。这一节中我们将从 web 端出发，探寻客户端与微服务交互的方法。 micro 工具集 已经"><meta property="og:type" content="blog"><meta property="og:title" content="Microservices in Golang - Part6"><meta property="og:url" content="https://fusidic.github.io/"><meta property="og:site_name" content="Fusidic&#039;s blog"><meta property="og:description" content="内容提要：API GATEWAY &amp;amp; UI 原作者：Ewan Valentine 原文链接：https:&amp;#x2F;&amp;#x2F;ewanvalentine.io&amp;#x2F;microservices-in-golang-part-6&amp;#x2F; 引言前文中我们从事件驱动架构出发，关注了 go-micro 和原生 go 中事件驱动的一般实现。这一节中我们将从 web 端出发，探寻客户端与微服务交互的方法。 micro 工具集 已经"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2020/05/15/tROShdVQXzYyoDW.png"><meta property="og:image" content="https://i.loli.net/2020/05/15/gp4FmUbWTyzK3VS.png"><meta property="article:published_time" content="2020-05-13T06:54:45.000Z"><meta property="article:modified_time" content="2020-05-15T08:50:18.000Z"><meta property="article:author" content="arithbar"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Microservices"><meta property="article:tag" content="Translation"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://i.loli.net/2020/05/15/tROShdVQXzYyoDW.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://fusidic.github.io/2020/05/13/MicroservicesinGolangPart6/"},"headline":"Fusidic's blog","image":["https://i.loli.net/2020/05/15/tROShdVQXzYyoDW.png","https://i.loli.net/2020/05/15/gp4FmUbWTyzK3VS.png"],"datePublished":"2020-05-13T06:54:45.000Z","dateModified":"2020-05-15T08:50:18.000Z","author":{"@type":"Person","name":"arithbar"},"description":"内容提要：API GATEWAY &amp; UI 原作者：Ewan Valentine 原文链接：https:&#x2F;&#x2F;ewanvalentine.io&#x2F;microservices-in-golang-part-6&#x2F; 引言前文中我们从事件驱动架构出发，关注了 go-micro 和原生 go 中事件驱动的一般实现。这一节中我们将从 web 端出发，探寻客户端与微服务交互的方法。 micro 工具集 已经"}</script><link rel="canonical" href="https://fusidic.github.io/2020/05/13/MicroservicesinGolangPart6/"><link rel="icon" href="/img/favicon.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Fusidic&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/fusidic"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-13T06:54:45.000Z" title="2020-05-13T06:54:45.000Z">2020-05-13</time><span class="level-item"><a class="link-muted" href="/categories/Developments/">Developments</a><span> / </span><a class="link-muted" href="/categories/Developments/Microservices/">Microservices</a></span><span class="level-item">19 分钟 读完 (大约 2867 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Microservices in Golang - Part6</h1><div class="content"><p>内容提要：<strong>API GATEWAY &amp; UI</strong></p>
<p>原作者：Ewan Valentine</p>
<p>原文链接：<a href="https://ewanvalentine.io/microservices-in-golang-part-6/">https://ewanvalentine.io/microservices-in-golang-part-6/</a></p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p><a href="https://fusidic.github.io/2020/05/11/MicroservicesinGolangPart5/">前文</a>中我们从事件驱动架构出发，关注了 <em>go-micro</em> 和原生 <em>go</em> 中事件驱动的一般实现。这一节中我们将从 <em>web</em> 端出发，探寻客户端与微服务交互的方法。</p>
<p><a href="https://github.com/micro/micro">micro 工具集</a> 已经为我们提供了 <em>web</em> 端服务从外部直接调用我们内部 rpc 的方法。</p>
<p>我们将为货流平台创建一个用户界面，包括<strong>登录页面</strong>、<strong>创建 consignment 的接口</strong>。通过这节的学习我们可以将之前的内容全部联系起来。</p>
<a id="more"></a>

<h2 id="RPC-的“文艺复兴”"><a href="#RPC-的“文艺复兴”" class="headerlink" title="RPC 的“文艺复兴”"></a>RPC 的“文艺复兴”</h2><p><em>REST</em> 在 <em>web</em> 服务中已经制霸了很多年了，从它出现之后，就迅速地成为了客户机与服务器之间资源管理的主要方式。<em>REST</em> 的出现结束了 RPC 与 SOAP 的“混乱之治”，结束了它们那套过时且让人痛苦的实现方法。</p>
<p>你有体验过写 <code>wsdl</code> 文件吗? 🙄️</p>
<h3 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h3><p><em>REST</em> 向我们提供了一种简单实用且统一的管理资源的方法，它使用 http 动词 (Put, Post, Delete, Get) 来更加明确地描述正在执行的操作类型。<em>REST</em> 鼓励我们使用 http 错误代码来更好的描述来自服务器的响应。</p>
<p>在大多数情况下，这种方法都表现的很好，但是再好的东西也是优缺点的，<em>REST</em> 在<a href="https://medium.freecodecamp.org/rest-is-the-new-soap-97ff6c09896d">一些方面</a>收到很多人的抱怨，这里就不展开说了。</p>
<h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><p>用于在应用程序和服务器之间传递数据的三种模型：</p>
<ul>
<li><p>SOAP 模型（面向消息）</p>
</li>
<li><p>RPC 模型（面向方法）</p>
</li>
<li><p>REST 模型（面向资源）</p>
</li>
</ul>
<p><em>SOAP + WSDL</em> 因为过于麻烦，用的人已经很少了。而在一段时间内，都是 <em>REST</em> 在 <em>web</em> 领域独领风骚，不过借着微服务发展的顺风车，<em>RPC</em> 风格也开始渐渐复兴。</p>
<p><em>REST</em> 风格在管理多种不同资源时有很好的效果，但是微服务就其本质而言，通常只处理单一资源，所以我们就不需要在微服务的上下文中使用 <em>RESTful</em> 术语，相应的，我们可以更多的关注具体的操作与每个服务间的交互。</p>
<h2 id="Micro"><a href="#Micro" class="headerlink" title="Micro"></a>Micro</h2><p>在整个系列文章中，我们大量用到了 <em>go-micro</em> 微服务框架，现在我们将会接触到 <em>micro cli/toolkit<em>，</em>micro toolkit</em> 提供了 API 网关、sidecar、web 代理，以及一些其他很酷的功能，但是我们最主要用到的部分还是 API 网关。</p>
<p>API 网关允许我们将内部的 RPC 方法代理到 web 上，以 URL 的形式开放调用端口，客户端可以使用非常友好的 JSON rpc 对微服务中的方法进行调用。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>安装 <em>micro toolkit</em> ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get -u github.com/micro/micro</span><br></pre></td></tr></table></figure>

<p>同时拉取 Docker 镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull microhq/micro</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="修改代码"><a href="#修改代码" class="headerlink" title="修改代码"></a>修改代码</h3><p>修改 <code>user-service</code> 的部分代码，主要是错误处理和一些命名惯例。</p>
<ul>
<li><code>user-service/main.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-service/main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">	pb <span class="string">"github.com/EwanValentine/shippy-user-service/proto/auth"</span></span><br><span class="line">	<span class="string">"github.com/micro/go-micro"</span></span><br><span class="line">	_ <span class="string">"github.com/micro/go-plugins/registry/mdns"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建与数据库的连接</span></span><br><span class="line">	db, err := CreateConnection()</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">"Could not connect to DB: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 自动将用户数据类型转化为数据库的存储类型</span></span><br><span class="line">	<span class="comment">// 每次服务重启之后，都会检查变动，并将数据迁移</span></span><br><span class="line">	db.AutoMigrate(&amp;pb.User&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	repo := &amp;UserRepository&#123;db&#125;</span><br><span class="line"></span><br><span class="line">	tokenService := &amp;TokenService&#123;repo&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建服务</span></span><br><span class="line">	srv := micro.NewService(</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 注意：作者在这里使用了新仓库 shippy-user-service</span></span><br><span class="line">		<span class="comment">// 将 protobuf 中的声明由 user 改为了 auth</span></span><br><span class="line">		<span class="comment">// 此处依据自己的情况来修改，只需要注意</span></span><br><span class="line">		<span class="comment">// 名称必须与protobuf中声明的包名一致</span></span><br><span class="line">		<span class="comment">// API 参数也需要对应修改</span></span><br><span class="line">		micro.Name(<span class="string">"shippy.auth"</span>),</span><br><span class="line">		micro.Version(<span class="string">"latest"</span>),</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Init 方法会解析所有命令行参数</span></span><br><span class="line">	srv.Init()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取 broker 实例</span></span><br><span class="line">	publisher := micro.NewPublisher(<span class="string">"user.created"</span>, srv.Client())</span><br><span class="line"></span><br><span class="line">	pb.RegisterUserServiceHandler(srv.Server(), &amp;service&#123;repo, tokenService, publisher&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := srv.Run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">"user service error: %v\n"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你在此处依照作者的代码进行了修改，那么相应的，你还需要修改以下文件中的对应内容。</p>
<br/>

<ul>
<li><code>user-service/proto/auth/auth.proto</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shippy-user-service/proto/auth/auth.proto</span></span><br><span class="line">syntax = <span class="string">"proto3"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> auth;</span><br><span class="line"></span><br><span class="line">service Auth &#123;</span><br><span class="line">    rpc Create(User) returns (Response) &#123;&#125;</span><br><span class="line">    rpc Get(User) returns (Response) &#123;&#125;</span><br><span class="line">    rpc GetAll(Request) returns (Response) &#123;&#125;</span><br><span class="line">    rpc Auth(User) returns (Token) &#123;&#125;</span><br><span class="line">    rpc ValidateToken(Token) returns (Token) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message User &#123;</span><br><span class="line">    <span class="keyword">string</span> id = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">string</span> name = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">string</span> company = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">string</span> email = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">string</span> password = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Request &#123;&#125;</span><br><span class="line"></span><br><span class="line">message Response &#123;</span><br><span class="line">    User user = <span class="number">1</span>;</span><br><span class="line">    repeated User users = <span class="number">2</span>;</span><br><span class="line">    repeated Error errors = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Token &#123;</span><br><span class="line">    <span class="keyword">string</span> token = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">bool</span> valid = <span class="number">2</span>;</span><br><span class="line">    repeated Error errors = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Error &#123;</span><br><span class="line">    <span class="keyword">int32</span> code = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">string</span> description = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<ul>
<li><code>user-service/handler.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-service/handler.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"errors"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">	pb <span class="string">"github.com/EwanValentine/shippy-user-service/proto/auth"</span></span><br><span class="line">	micro <span class="string">"github.com/micro/go-micro"</span></span><br><span class="line">	<span class="string">"golang.org/x/crypto/bcrypt"</span></span><br><span class="line">	<span class="string">"golang.org/x/net/context"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> topic = <span class="string">"user.created"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> service <span class="keyword">struct</span> &#123;</span><br><span class="line">	repo         Repository</span><br><span class="line">	tokenService Authable</span><br><span class="line">	Publisher    micro.Publisher</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(srv *service)</span> <span class="title">Get</span><span class="params">(ctx context.Context, req *pb.User, res *pb.Response)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	user, err := srv.repo.Get(ctx, req.Id)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	res.User = user</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(srv *service)</span> <span class="title">GetAll</span><span class="params">(ctx context.Context, req *pb.Request, res *pb.Response)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	users, err := srv.repo.GetAll(ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	res.Users = users</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(srv *service)</span> <span class="title">Auth</span><span class="params">(ctx context.Context, req *pb.User, res *pb.Token)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对请求进行哈希</span></span><br><span class="line">	log.Println(<span class="string">"Logging in with:"</span>, req.Email, req.Password)</span><br><span class="line">	user, err := srv.repo.GetByEmail(req.Email)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	log.Println(user)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 验证密码</span></span><br><span class="line">	<span class="keyword">if</span> err := bcrypt.CompareHashAndPassword([]<span class="keyword">byte</span>(user.Password), []<span class="keyword">byte</span>(req.Password)); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	token, err := srv.tokenService.Encode(user)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	res.Token = token</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(srv *service)</span> <span class="title">Create</span><span class="params">(ctx context.Context, req *pb.User, res *pb.Response)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	log.Println(<span class="string">"Creating user: "</span>, req)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对密码进行哈希</span></span><br><span class="line">	hashedPass, err := bcrypt.GenerateFromPassword([]<span class="keyword">byte</span>(req.Password), bcrypt.DefaultCost)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">"error hashing password: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	req.Password = <span class="keyword">string</span>(hashedPass)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 新的 publisher 代码更简洁</span></span><br><span class="line">	<span class="keyword">if</span> err := srv.repo.Create(req); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">"error creating new user: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	res.User = req</span><br><span class="line">	<span class="keyword">if</span> err := srv.Publisher.Publish(ctx, req); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">"error publishing event: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(srv *service)</span> <span class="title">ValidateToken</span><span class="params">(ctx context.Context, req *pb.Token, res *pb.Token)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Decode token</span></span><br><span class="line">	claims, err := srv.tokenService.Decode(req.Token)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Println(claims)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> claims.User.Id == <span class="string">""</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"invalid user"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	res.Valid = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>现在可以使用 <code>$ make build &amp;&amp; make run</code> 来运行 <code>user-service</code> 和 <code>email-service</code> 了，并且此时还需要执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 8080:8080 \ </span><br><span class="line">    -e MICRO_REGISTRY=mdns \</span><br><span class="line">    microhq/micro api \</span><br><span class="line">    --handler=rpc \</span><br><span class="line">    --address=:8080 \</span><br><span class="line">    --namespace=shippy</span><br></pre></td></tr></table></figure>

<p>这行命令在本机的 <code>8080</code> 端口上运行了一个 <em>micro api-gateway</em> 的容器来处理 RPC 请求，并且规定了容器使用 <code>mdns</code> 作为本地的注册地址，这个和其他容器都是一样的。</p>
<p>最后，我们告诉容器使用 <code>shippy</code> 的名称空间 (namespace) ，这是我们所有服务名称的开头部分，如 <code>shippy.auth</code> 或者 <code>shippy.email</code> 等。这个设置非常重要，否则所有服务都会使用默认命名空间 <code>go.micro.api</code> ，这会使我们无法找到服务来代理。</p>
<p>####创建用户</p>
<p>创建用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPOST -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123; "service": "shippy.user", "method": "Auth.Create", "request": &#123; "user": &#123; "email": "ewan.valentine89@gmail.com", "password": "testing123", "name": "Ewan Valentine", "company": "BBC" &#125; &#125; &#125;'</span> http://localhost:8080/rpc</span><br></pre></td></tr></table></figure>

<blockquote>
<p>译者注：</p>
<p>在本地直接运行 <em>micro</em> 也是可以的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/micro/micro  <span class="comment"># 注意为 v1 版本</span></span><br><span class="line"></span><br><span class="line">$ MICRO_API_HANDLER=rpc \</span><br><span class="line">	MICRO_API_NAMESPACE=shippy \       </span><br><span class="line">	MICRO_API_REGISTRY=mdns \</span><br><span class="line">	MICRO_API_ENABLE_RPC=<span class="literal">true</span> \</span><br><span class="line">	MICRO_API_ADDRESS=<span class="string">":8080"</span> \</span><br><span class="line">	micro api</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 容器运行</span></span><br><span class="line">$ docker run -p 8080:8080 \</span><br><span class="line">	-e MICRO_REGISTRY=mdns \</span><br><span class="line">	-e MICRO_API_NAMESPACE=shippy \</span><br><span class="line">	-e MICRO_API_ENABLE_RPC=<span class="literal">true</span> \</span><br><span class="line">	-e MICRO_API_ADDRESS=<span class="string">":8080"</span> \</span><br><span class="line">	microhq/micro api \</span><br><span class="line">	--handler=rpc \</span><br><span class="line">	--address=:8080 \</span><br><span class="line">	--namespace=shippy</span><br></pre></td></tr></table></figure>

<p>看起来这样写很诡异，但是确实只有这样才能正常运行。因为经验欠缺，且 <em>micro</em> 错误难以定位，找出这个问题花费了大量的时间。</p>
</blockquote>
<p><img src="https://i.loli.net/2020/05/15/tROShdVQXzYyoDW.png" alt="userservice"></p>
<p>如你所见，在请求中包含了我们想要路由的服务、服务中我们想要用的方法，以及我们希望用到的数据。</p>
<p>认证用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPOST -H <span class="string">'Content-Type: application/json'</span> \ </span><br><span class="line">    -d <span class="string">'&#123; "service": "shippy.auth", "method": "Auth.Auth", "request":  &#123; "email": "your@email.com", "password": "SomePass" &#125; &#125;'</span> \</span><br><span class="line">    http://localhost:8080/rpc</span><br></pre></td></tr></table></figure>

<h4 id="创建订单"><a href="#创建订单" class="headerlink" title="创建订单"></a>创建订单</h4><p>再次运行 <code>consignment-service</code> ，这里无需修改任何代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make build &amp;&amp; make run</span><br></pre></td></tr></table></figure>

<p>创建 <em>consignment</em> ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPOST -H <span class="string">'Content-Type: application/json'</span> \ </span><br><span class="line">    -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">      "service": "shippy.consignment",</span></span><br><span class="line"><span class="string">      "method": "ConsignmentService.Create",</span></span><br><span class="line"><span class="string">      "request": &#123;</span></span><br><span class="line"><span class="string">        "description": "This is a test",</span></span><br><span class="line"><span class="string">        "weight": "500",</span></span><br><span class="line"><span class="string">        "containers": []</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;'</span> --url http://localhost:8080/rpc</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/05/15/gp4FmUbWTyzK3VS.png" alt="consignment"></p>
<h4 id="创建货船"><a href="#创建货船" class="headerlink" title="创建货船"></a>创建货船</h4><p>同样的，在 <code>vessel-service</code> 中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make build &amp;&amp; make run</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="用户界面"><a href="#用户界面" class="headerlink" title="用户界面"></a>用户界面</h2><p>接下来我们会用 React 来构建用户 UI 界面 (其实可以不管用什么前端工具都可以，只要发出的请求是一样的就行)。我们这里就直接使用 Facebook 的 <code>react-create-app</code> 库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g react-create-app</span><br><span class="line"></span><br><span class="line">$ react-creat-app shippy-ui</span><br></pre></td></tr></table></figure>

<p>你会直接生成一个 React 应用的脚手架，填充自己的代码.</p>
<br/>

<h3 id="App-js"><a href="#App-js" class="headerlink" title="App.js"></a>App.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shippy-ui/src/App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"><span class="keyword">import</span> CreateConsignment <span class="keyword">from</span> <span class="string">'./CreateConsignment'</span>;</span><br><span class="line"><span class="keyword">import</span> Authenticate <span class="keyword">from</span> <span class="string">'./Authenticate'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    err: <span class="literal">null</span>,</span><br><span class="line">    authenticated: <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onAuth = <span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      authenticated: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  renderLogin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Authenticate onAuth=&#123;<span class="keyword">this</span>.onAuth&#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  renderAuthenticated = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;CreateConsignment /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getToken = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> localStorage.getItem(<span class="string">'token'</span>) || <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  isAuthenticated = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.state.authenticated || <span class="keyword">this</span>.getToken() || <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> authenticated = <span class="keyword">this</span>.isAuthenticated();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">"App-header"</span>&gt;</span><br><span class="line">          &lt;h2&gt;Shippy&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &lt;div className=<span class="string">'App-intro container'</span>&gt;</span><br><span class="line">          &#123;(authenticated ? <span class="keyword">this</span>.renderAuthenticated() : <span class="keyword">this</span>.renderLogin())&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="用户认证组件"><a href="#用户认证组件" class="headerlink" title="用户认证组件"></a>用户认证组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shippy-ui/src/Authenticate.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Authenticate</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    authenticated: <span class="literal">false</span>,</span><br><span class="line">    email: <span class="string">''</span>,</span><br><span class="line">    password: <span class="string">''</span>,</span><br><span class="line">    err: <span class="string">''</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  login = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fetch(<span class="string">`http://localhost:8080/rpc`</span>, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        request: &#123;</span><br><span class="line">          email: <span class="keyword">this</span>.state.email,</span><br><span class="line">          password: <span class="keyword">this</span>.state.password,</span><br><span class="line">        &#125;,</span><br><span class="line">        service: <span class="string">'shippy.auth'</span>,</span><br><span class="line">        method: <span class="string">'Auth.Auth'</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.props.onAuth(res.token);</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        token: res.token,</span><br><span class="line">        authenticated: <span class="literal">true</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; err, <span class="attr">authenticated</span>: <span class="literal">false</span>, &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  signup = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fetch(<span class="string">`http://localhost:8080/rpc`</span>, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        request: &#123;</span><br><span class="line">          email: <span class="keyword">this</span>.state.email,</span><br><span class="line">          password: <span class="keyword">this</span>.state.password,</span><br><span class="line">          name: <span class="keyword">this</span>.state.name,</span><br><span class="line">        &#125;,</span><br><span class="line">        method: <span class="string">'Auth.Create'</span>,</span><br><span class="line">        service: <span class="string">'shippy.auth'</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.props.onAuth(res.token.token);</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        token: res.token.token,</span><br><span class="line">        authenticated: <span class="literal">true</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      localStorage.setItem(<span class="string">'token'</span>, res.token.token);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; err, <span class="attr">authenticated</span>: <span class="literal">false</span>, &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setEmail = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      email: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setPassword = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      password: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setName = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      name: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">'Authenticate'</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">'Login'</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">'form-group'</span>&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              type=<span class="string">"email"</span></span><br><span class="line">              onChange=&#123;<span class="keyword">this</span>.setEmail&#125;</span><br><span class="line">              placeholder=<span class="string">'E-Mail'</span></span><br><span class="line">              className=<span class="string">'form-control'</span> /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className='form-group'&gt;</span></span><br><span class="line"><span class="regexp">            &lt;input</span></span><br><span class="line"><span class="regexp">              type="password"</span></span><br><span class="line"><span class="regexp">              onChange=&#123;this.setPassword&#125;</span></span><br><span class="line"><span class="regexp">              placeholder='Password'</span></span><br><span class="line"><span class="regexp">              className='form-control' /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;button className='btn btn-primary' onClick=&#123;this.login&#125;&gt;Login&lt;/</span>button&gt;</span><br><span class="line">          &lt;br /&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className='Sign-up'&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className='form-group'&gt;</span></span><br><span class="line"><span class="regexp">            &lt;input</span></span><br><span class="line"><span class="regexp">              type='input'</span></span><br><span class="line"><span class="regexp">              onChange=&#123;this.setName&#125;</span></span><br><span class="line"><span class="regexp">              placeholder='Name'</span></span><br><span class="line"><span class="regexp">              className='form-control' /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className='form-group'&gt;</span></span><br><span class="line"><span class="regexp">            &lt;input</span></span><br><span class="line"><span class="regexp">              type='email'</span></span><br><span class="line"><span class="regexp">              onChange=&#123;this.setEmail&#125;</span></span><br><span class="line"><span class="regexp">              placeholder='E-Mail'</span></span><br><span class="line"><span class="regexp">              className='form-control' /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className='form-group'&gt;</span></span><br><span class="line"><span class="regexp">            &lt;input</span></span><br><span class="line"><span class="regexp">              type='password'</span></span><br><span class="line"><span class="regexp">              onChange=&#123;this.setPassword&#125;</span></span><br><span class="line"><span class="regexp">              placeholder='Password'</span></span><br><span class="line"><span class="regexp">              className='form-control' /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;button className='btn btn-primary' onClick=&#123;this.signup&#125;&gt;Sign-up&lt;/</span>button&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Authenticate;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="货物托运组件"><a href="#货物托运组件" class="headerlink" title="货物托运组件"></a>货物托运组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// shippy-ui/src/CreateConsignment.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateConsignment</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    created: <span class="literal">false</span>,</span><br><span class="line">    description: <span class="string">''</span>,</span><br><span class="line">    weight: <span class="number">0</span>,</span><br><span class="line">    containers: [],</span><br><span class="line">    consignments: [],</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    fetch(<span class="string">`http://localhost:8080/rpc`</span>, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        service: <span class="string">'shippy.consignment'</span>,</span><br><span class="line">        method: <span class="string">'ConsignmentService.Get'</span>,</span><br><span class="line">        request: &#123;&#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">req</span> =&gt;</span> req.json())</span><br><span class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        consignments: res.consignments,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  create = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> consignment = <span class="keyword">this</span>.state;</span><br><span class="line">    fetch(<span class="string">`http://localhost:8080/rpc`</span>, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        service: <span class="string">'shippy.consignment'</span>,</span><br><span class="line">        method: <span class="string">'ConsignmentService.Create'</span>,</span><br><span class="line">        request: _.omit(consignment, <span class="string">'created'</span>, <span class="string">'consignments'</span>),</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        created: res.created,</span><br><span class="line">        consignments: [...this.state.consignments, consignment],</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addContainer = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      containers: [...this.state.containers, e.target.value],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setDescription = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      description: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setWeight = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      weight: <span class="built_in">Number</span>(e.target.value),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; consignments, &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">'consignment-screen'</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">'consignment-form container'</span>&gt;</span><br><span class="line">          &lt;br /&gt;</span><br><span class="line">          &lt;div className=<span class="string">'form-group'</span>&gt;</span><br><span class="line">            &lt;textarea onChange=&#123;<span class="keyword">this</span>.setDescription&#125; className=<span class="string">'form-control'</span> placeholder=<span class="string">'Description'</span>&gt;&lt;<span class="regexp">/textarea&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">          &lt;div className=<span class="string">'form-group'</span>&gt;</span><br><span class="line">            &lt;input onChange=&#123;<span class="keyword">this</span>.setWeight&#125; type=<span class="string">'number'</span> placeholder=<span class="string">'Weight'</span> className=<span class="string">'form-control'</span> /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className='form-control'&gt;</span></span><br><span class="line"><span class="regexp">            Add containers...</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">          &lt;br /&gt;</span><br><span class="line">          &lt;button onClick=&#123;<span class="keyword">this</span>.create&#125; className=<span class="string">'btn btn-primary'</span>&gt;Create&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;br /</span>&gt;</span><br><span class="line">          &lt;hr /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &#123;(consignments &amp;&amp; consignments.length &gt; 0</span></span><br><span class="line"><span class="regexp">          ? &lt;div className='consignment-list'&gt;</span></span><br><span class="line"><span class="regexp">              &lt;h2&gt;Consignments&lt;/</span>h2&gt;</span><br><span class="line">              &#123;consignments.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                  &lt;p&gt;Vessel id: &#123;item.vessel_id&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;p&gt;Consignment id: &#123;item.id&#125;&lt;/</span>p&gt;</span><br><span class="line">                  &lt;p&gt;Description: &#123;item.description&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;p&gt;Weight: &#123;item.weight&#125;&lt;/</span>p&gt;</span><br><span class="line">                  &lt;hr /&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              ))&#125;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">          : <span class="literal">false</span>)&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default CreateConsignment;</span></span><br></pre></td></tr></table></figure>

<p><em>注意：我在 <code>public/index.html</code> 中也加入了 Twitter 的 Bootstrap，包括一些可用的 css 文件，见<a href="https://github.com/EwanValentine/shippy-ui">仓库</a>.</em></p>
<p>现在执行 <code>$ npm start</code> 应该可以浏览器自动打开这个页面，现在就可以通过 web 页面直接注册、登陆以及新鲜货运订单了。</p>
<img>

<p>注意在开发者模式中观察一下前端是如何远程调用方法并且从不同的微服务中获取数据的。</p>
<img>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>好的，这就是第六节的所有内容了! </p>
<p>任何漏洞，错误或者反馈，欢迎你通过邮件[告诉我](mailto: <a href="mailto:ewan.valentine89@gmail.com">ewan.valentine89@gmail.com</a>)。</p>
<br/>

<p>觉得这系列文章对您有帮助，可以请原作者喝杯咖啡，Cheers! <a href="https://monzo.me/ewanvalentine">https://monzo.me/ewanvalentine</a>.</p>
<p>或者通过 <a href="https://www.patreon.com/ewanvalentine">Patreon</a> 来支持原作者。</p>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Golang/">Golang</a><a class="link-muted mr-2" rel="tag" href="/tags/Microservices/">Microservices</a><a class="link-muted mr-2" rel="tag" href="/tags/Translation/">Translation</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/05/17/MicroservicesinGolangPart7/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Microservices in Golang - Part7</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/05/11/MicroservicesinGolangPart5/"><span class="level-item">Microservices in Golang - Part5</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#引言"><span class="mr-2">1</span><span>引言</span></a></li><li><a class="is-flex" href="#RPC-的“文艺复兴”"><span class="mr-2">2</span><span>RPC 的“文艺复兴”</span></a><ul class="menu-list"><li><a class="is-flex" href="#REST"><span class="mr-2">2.1</span><span>REST</span></a></li><li><a class="is-flex" href="#RPC"><span class="mr-2">2.2</span><span>RPC</span></a></li></ul></li><li><a class="is-flex" href="#Micro"><span class="mr-2">3</span><span>Micro</span></a><ul class="menu-list"><li><a class="is-flex" href="#使用"><span class="mr-2">3.1</span><span>使用</span></a></li><li><a class="is-flex" href="#修改代码"><span class="mr-2">3.2</span><span>修改代码</span></a></li><li><a class="is-flex" href="#运行"><span class="mr-2">3.3</span><span>运行</span></a><ul class="menu-list"><li><a class="is-flex" href="#创建订单"><span class="mr-2">3.3.1</span><span>创建订单</span></a></li><li><a class="is-flex" href="#创建货船"><span class="mr-2">3.3.2</span><span>创建货船</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#用户界面"><span class="mr-2">4</span><span>用户界面</span></a><ul class="menu-list"><li><a class="is-flex" href="#App-js"><span class="mr-2">4.1</span><span>App.js</span></a></li><li><a class="is-flex" href="#用户认证组件"><span class="mr-2">4.2</span><span>用户认证组件</span></a></li><li><a class="is-flex" href="#货物托运组件"><span class="mr-2">4.3</span><span>货物托运组件</span></a></li></ul></li><li><a class="is-flex" href="#总结"><span class="mr-2">5</span><span>总结</span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-18T08:51:10.000Z">2020-09-18</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/18/CustomScheduler3/">Schedule Framework 扩展调度器</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-29T13:30:34.206Z">2020-07-29</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/29/Kubernetes-rtfsc1/">[RTFSC]Kubernetes 资源对象与控制器</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/DeepIn/">DeepIn</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-10T13:30:36.000Z">2020-07-10</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/10/k8s-RABC/">Kubernetes RABC 权限控制</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Operations/">Operations</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-12T09:07:50.000Z">2020-06-12</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/12/LinuxPerformanceTool/">Linux性能调优</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Operations/">Operations</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-03T13:44:16.000Z">2020-06-03</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/03/LinuxNetworkAnalyze/">Linux 网络分析</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Operations/">Operations</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Fusidic&#039;s blog" height="28"></a><p class="size-small"><span>&copy; 2020 arithbar</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://fusidic.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>